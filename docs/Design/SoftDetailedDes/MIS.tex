\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}
\usepackage{ dsfont }
\usepackage{textcomp}
\usepackage[T1]{fontenc}
\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../Comments}
\input{../Common}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
January 13, 2024 & 1.0 & Initial changes\\
January 15 & 1.1 & Module Definitions\\
January 16 & 1.2 & Module Details\\
January 17 & 1.3 & Appendix\\
January 18 & 1.4 & Revision 0\\
April 2 & 1.5 & Adding new modules and removing old ones\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation \href{https://github.com/SammyG7/Mac-AR/blob/main/docs/SRS/SRS.pdf} {here}\\


\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l} 
  \toprule		
  \textbf{symbol} & \textbf{description}\\
  \midrule 
  AR & Augmented Reality\\
  M & Module \\
  MG & Module Guide \\
  MIS & Module Interface Specification\\
  OS & Operating System \\
  SRS & Software Requirements Specification\\
  \bottomrule
\end{tabular}\\

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for the Mac-AR Augmented Reality escape room style game.

Complementary documents include the \href{https://github.com/SammyG7/Mac-AR/blob/main/docs/SRS/SRS.pdf}{System Requirement Specifications}
and \href{https://github.com/SammyG7/Mac-AR/blob/main/docs/Design/SoftArchitecture/MG.pdf}{Module Guide}.  The full documentation and implementation can be
found at \url{https://github.com/SammyG7/Mac-AR}. 

\section{Notation}

The structure of the MIS for modules comes from \citet{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\citet{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by \progname. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{l l p{7.5cm}} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
character & char & a single symbol or digit\\
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
string & string & a group of characters\\
Lobby & Lobby & represents a lobby object\\
LobbiesList & LobbiesList & represents a collection of lobbies\\
Array of ... & Array of ... & represents an array containing elements of a particular data type\\
ChannelID & ChannelID & represents a voice/text channel object\\
IParticipant & IParticipant & represents a voice/text chat participant object \\
TextMessage & TextMessage & represents the text message data type present in Vivox library\\
UnityObject & UnityObject & represents unity objects\\
PlayerData & PlayerData & tuple representing a player by an ID and ready status\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of Mac-AR \ uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, Mac-AR \ uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
\centering
\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
\toprule
\textbf{Level 1} & \textbf{Level 2}\\
\midrule

{Hardware-Hiding Module} & Hardware Module \\
\midrule

\multirow{7}{0.3\textwidth}{Behaviour-Hiding Module}
& Game Room Module\\
& Text Communication Module\\
& Voice Communication Module\\
& Multiplayer Puzzle Module\\
& Simon Says Puzzle Module\\
& Isometric Puzzle Module\\
& Wires Puzzle Module\\
& Maze Puzzle Module\\
& Bomb Puzzle Module\\
\midrule

\multirow{3}{0.3\textwidth}{Software Decision Module} & Database/Network Manager Module\\
& Error Manager Module\\
& Documentation Module\\
\bottomrule

\end{tabular}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}

\newpage

\section{MIS of {Hardware Module}} \label{sec:HardwareModule} 

\subsection{Module}

This module is dependant on the user's phone, and the hardware interfaces are entirely dependant on the device used. 

\subsection{Uses}
 None

\subsection{Syntax}

\subsubsection{Exported Constants}
N/A
\subsubsection{Exported Access Programs}
N/A
\subsection{Semantics}

\subsubsection{State Variables}

None

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

Assuming the device the user is using has a working camera and gyroscope, and the required firmware to run the application

\subsubsection{Access Routine Semantics}

Implemented by operating system

\subsubsection{Local Functions}

Implemented by operating system

\newpage

\section{MIS of Game Room Module} \label{sec:GameRoomModule} 
\subsection{Module}

GameRoomModule

\subsection{Uses}

Database/Network Manager Module

\subsection{Syntax}

\subsubsection{Exported Constants}

Min Room Capacity = 2\\
Max Room Capacity = 10\\
Minimum Password Length = 8\\
Maximum Password length = 64\\

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
StartHost & $\mathbb{N}$, string, string & - & - \\
Initialize  & LobbiesList, Lobby & - & - \\
readyPress  & - & $\mathbb{B}$ & - \\
RefreshLobbiesList  & - & LobbiesList & - \\
JoinAsync  & Lobby, string & $\mathbb{B}$ & - \\
StartGame & - & - & - \\
setLobby  & Lobby & - & - \\
setConnections & $\mathbb{N}$ & - & - \\
setPassword & string & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

inLobby : $\mathbb{B}$\\
isReady : $\mathbb{B}$\\
isJoining : $\mathbb{B}$\\
lobbies : LobbiesList

\subsubsection{Environment Variables}

This module has external interaction with the phone screen the user is using, there will be buttons to be pressed to call some of these functions.

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent readyPress():
\begin{itemize}
\item output: out := isReady
\item exception: None
\end{itemize}\

\noindent {JoinAsync}(lobby,password):
\begin{itemize}
\item transition: $join := (lobby.password=password \land lobby.availableSlots>0)$
\item output: out := isJoining
\item exception: None
\end{itemize}

\noindent {RefreshLobbiesList}():
\begin{itemize}
\item transition: $\forall lobby \in lobbies \implies Initialize(lobby)$
\item output: out:=lobbies
\item exception: None
\end{itemize}

\noindent {StartGame}():
\begin{itemize}
\item transition: GameScene := Puzzle
\item exception: None
\end{itemize}

\noindent {StartHost}(connections, lobbyName, password):
\begin{itemize}
\item transition: GameScene := Lobby, Lobby.MaxConnections := connections, Lobby.LobbyName := lobbyName, Lobby.Password := password
\item exception: None
\end{itemize}

\noindent {setLobby}(lobby):
\begin{itemize}
\item transition: Lobby := lobby
\item exception: None
\end{itemize}

\noindent {setConnections}(connections):
\begin{itemize}
\item transition: Lobby.MaxConnections := connections
\item exception: None
\end{itemize}

\noindent {setPassword}(password):
\begin{itemize}
\item transition: Lobby.Password := password
\item exception: None 
\end{itemize}

\subsubsection{Local Functions}

None

\newpage

\section{MIS of Text Communication Module} \label{sec:text} 

  This module uses the built in Unity library called Vivox to implement text chat.


\subsection{Module}
textCommunication

\subsection{Uses}
Vivox (Unity Library)\\
Database/Network Manager Module

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{6cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
ClearMessageObjectPool & - & - & - \\
ClearOutTextField & - & - & - \\
SubmitTextToVivox & - & - & - \\
EnterKeyOnTextField & - & - & - \\
SendScrollRectToBottom & - & - & - \\
OnParticipantAdded & string, ChannelID, IParticipant & - & - \\
OnTextMessageLogReceivedEvent & string, IChannelTextMessage & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None
\subsubsection{Environment Variables}

Device screen\\
Device keyboard\\
There are UI components such as a chat box and buttons that will be present on the user screen when some of these access routines are called.\\

\subsubsection{Assumptions}

None\\

\subsubsection{Access Routine Semantics}

\noindent ClearMessageObjectPool():
\begin{itemize}
\item transition: Clear chatbox
\item exception: None
\end{itemize}


\noindent ClearOutTextField():
\begin{itemize}
\item transition: Clear user chat box input field
\item exception: None
\end{itemize}

\noindent SubmitTextToVivox():
\begin{itemize}
\item transition: Send text message present in input field to \_textChannel
\item exception: None
\end{itemize}

\noindent EnterKeyOnTextField():
\begin{itemize}
\item transition: $user.input == return =>  SubmitTextToVivox()$
\item exception: None
\end{itemize}

\noindent SendScrollRectToBottom():
\begin{itemize}
\item transition: Enable scrolling of \_textChatScrollRect
\item exception: None
\end{itemize}

\noindent OnParticipantAdded(username, channel, participant):
\begin{itemize}
\item transition: $\_vivoxVoiceManager.channel.users = \_vivoxVoiceManager.channel.users + 1$
\item exception: None
\end{itemize}

\noindent OnTextMessageLogReceivedEvent(sender, channelTextMessage):
\begin{itemize}
\item transition: $channelTextMessage.FromSelf == 1 => sender.color = green \newline \land SendScrollRectToBottom$

$channelTextMessage.FromSelf == 0 => sender.color = white \land SendScrollRectToBottom$
\item exception: None
\end{itemize}

\subsubsection{Local Functions}


\subsubsection{Local Variables}
\_vivoxVoiceManager : VivoxVoiceManager instance\\
\_textChannel : ChannelId\\
\_textChatScrollRect : ScrollRect\\


\newpage

\section{MIS of Voice Communication Module} \label{sec:voice} 
This module uses the built in Unity library called Vivox to implement voice chat.

\subsection{Module}
voiceCommunication

\subsection{Uses}
Vivox (Unity Library)\\
Database/Network Manager Module

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
Start & - & - & - \\
IsMicPermissionGranted  & - & $\mathds{B}$ & - \\
AskForPermissions  & - &  & - \\
OnUserLoggedIn  & - & - & SignInException \\
OnUserLoggedOut  & - & - & - \\
VivoxToggle  & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

VoiceToggleIsOn : $\mathds{B}$\\
\_vvm : Vivox voice manager instance

\subsubsection{Environment Variables}

Device microphone\\
Device audio\\
Device screen

\subsubsection{Assumptions}

None\\

\subsubsection{Access Routine Semantics}

\noindent isMicPermissionGranted():
\begin{itemize}
\item transition: $isGranted = Permission.HasUserAuthorizedPermission(Permission.Microphone)$
\item output: $out :=$ isGranted
\item exception: None
\end{itemize}

\noindent AskForPermissions():
\begin{itemize}
\item transition: Request access to user microphone
\item exception: None
\end{itemize}

\noindent OnUserLoggedIn():
\begin{itemize}
\item transition: $\_vvm.LoginState == VivoxUnity.LoginState.LoggedIn =>$ Join voice channel
\item exception: $\_vvm.LoginState != VivoxUnity.LoginState.LoggedIn =>$ SignInException
\end{itemize}

\noindent OnUserLoggedOut():
\begin{itemize}
\item transition: Disconnect from Vivox voice manager
\item exception: None
\end{itemize}

\noindent VivoxToggle():
\begin{itemize}
\item transition: $VoiceToggleIsOn => AudioInputDevice.Muted = false$

$!VoiceToggleIsOn => AudioInputDevice.Muted = true$
\item exception: None
\end{itemize}

\subsubsection{Local Functions}

None

\newpage

\section{MIS of {Multiplayer Puzzle Module}} \label{sec:Puzzle} 

The base module that all other puzzle modules will inherit from. The module will handle all of the common behaviour shared between the puzzle implementations. This consists of the puzzle hint system, the puzzle skip system, and the coordination between users working on the same puzzle instance. 

\subsection{Module}
MultiplayerPuzzleModule

\subsection{Uses}
Database/Network Manager Module\\
Error Manager Module

\subsection{Syntax}

\subsubsection{Exported Constants}
ALLOWED\_SKIPS = 3 \newline
\noindent ALLOWED\_HINTS = 3

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{3cm} p{3cm} p{3cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GeneratePuzzle & - & - & - \\
SkipPuzzle & $\mathds{Z}$ & $\mathds{B}$ & - \\
GenerateHint & $\mathds{Z}$ & string & - \\
CompletePuzzle & $\mathds{Z}$ & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

PuzzlePlayers : Tuple\textlangle$\mathds{Z}$, Array\textlangle$\mathds{Z}$\textrangle\textrangle

\subsubsection{Environment Variables}

PlayerIds : Array\textlangle$\mathds{Z}$\textrangle

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent {GeneratePuzzle}():
\begin{itemize}
\item transition: Assign all available players to a puzzle in the PuzzlePlayers tuple
\end{itemize}

\noindent {SkipPuzzle}(playerId):
\begin{itemize}
\item transition: $\forall$ player $\in$ PuzzlePlayers[getCurrentPuzzle(playerId)] : \newline PuzzlePlayers[newPuzzle].append(player) $\land$ numSkips++
\item output: numSkips \textless ALLOWED SKIPS
\end{itemize}

\noindent {GenerateHint}(playerId):
\begin{itemize}
\item transition: $\forall$ player $\in$ PuzzlePlayers[getCurrentPuzzle(playerId)] : \newline PuzzlePlayers[newPuzzle].appnd(player) $\land$ numHints++
\item output: numHints \textless ALLOWED HINTS $\Rightarrow$ hintString
\end{itemize}

\noindent {CompletePuzzle}(playerId):
\begin{itemize}
\item transition: $\forall$ player $\in$ PuzzlePlayers[getCurrentPuzzle(playerId)] : \newline PuzzlePlayers[newPuzzle].append(player)
\end{itemize}

\subsubsection{Local Functions}

None

\subsubsection{Local Variables}

None

\newpage

\section{MIS of Simon Says Puzzle Module} \label{sec:Simon}

\noindent The Simon Says Puzzle Module implements functionality for the Simon Says puzzle that is present in the application. This puzzle involves two users. User 1 has a 4 buttons of different colours (red, blue, green, yellow) in their game environment and User 2 has a cube in their environment that flashes with different colours. User 2 must remember the pattern of colours that was shown and communicate with User 1 to let them know the order to press the coloured buttons in.

\subsection{Module}
SimonSaysPuzzle

\subsection{Uses}
Multiplayer Puzzle Module

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GenerateColourSequence & - & Array of $\mathds{N}$ & - \\
DisableInteractionWithButtons & - & - & - \\
EnableInteractionWithButtons & - & - & - \\
TrackUserInput & - & - & - \\
CheckIfSuccess & Array of $\mathds{N}$ & $\mathds{B}$ & - \\
IncrementLevel & - & - & - \\
ResetLevel & - & - & - \\
UpdateCubeServerRpc & Colour & - & - \\
UpdateTextServerRpc & string & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
level := 1 $\{1<=\mathbb{N}<4\}$\\
success : $\mathds{B}$\\
colourSequenceArray : Array of $\mathds{N}$\\
buttonsArray := \{0, 1, 2, 3\}\\
%colourDictionary := $\{Red -> 0, Blue -> 1, Green -> 2, Yellow -> 3\}$

\subsubsection{Environment Variables}

Device Screen\\
This module has external interaction with the phone screen, as there will be buttons in the game environment that the user presses which will be mapped to functions


\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent GenerateColourSequence():
\begin{itemize}
\item transition: $ \forall i: level <= i < level + 1 : \newline colourSequenceArray.append(randInt(0,4))$
\item output: out := colourSequenceArray
\item exception: None
\end{itemize}

\noindent DisableInteractionWithButtons():
\begin{itemize}
\item transition: $ \forall i: 0 <= i < 4 :$ \newline buttonsArray[i].interactable = False
\item exception: None
\end{itemize}

\noindent EnableInteractionWithButtons():
\begin{itemize}
\item transition: $ \forall i: 0 <= i < 4 :$ \newline buttonsArray[i].interactable = True
\item exception: None
\end{itemize}

\noindent TrackUserInput():
\begin{itemize}
\item transition: Detect and store user input order of buttons in game environment
\item exception: None
\end{itemize}

\noindent CheckIfSuccess(sequence):
\begin{itemize}
\item transition: $success == False => ResetLevel()$
\item output: success := $ \forall i: 0 <= i < length(sequence) : \newline sequence[i] == userInput[i] => True  \: | \: else => False$
\item exception: None
\end{itemize}

\noindent UpdateCubeServerRpc(colour):
\begin{itemize}
\item transition: Cube flashes colour present in input for all users besides player 1
\item exception: None
\end{itemize}

\noindent UpdateTextServerRpc(text):
\begin{itemize}
\item transition: Simon Says level text updated amongst all users when correct or incorrect sequence inputted
\item exception: None
\end{itemize}

\noindent IncreaseLevel():
\begin{itemize}
\item transition: level := level + 1
\item exception: None
\end{itemize}

\noindent ResetLevel():
\begin{itemize}
\item transition: level := 1
\item exception: None
\end{itemize}

\subsubsection{Local Functions}
None
\subsubsection{Local Variables}
None
\newpage

\section{MIS of Isometric Puzzle Module} \label{sec:Code}
\noindent The Isometric Puzzle Module implements functionality for the Isometric puzzle that is present in the application. This puzzle involves 2-8 players. Each player has an equally distributed amount of letters. e.g with 2 players, each player will receive 4 letters. The players will look at the arrangement of cubes from different angles, and it will appear to be a letter from one angle, and a number from the other angle. The players must put together all their letters at their respective index indicated by the number they see to complete the final word.

\subsection{Module}
IsometricPuzzle

\subsection{Uses}
Multiplayer Puzzle Module

\subsection{Syntax}

\subsubsection{Exported Constants}
SOLUTION = "TWILIGHT"

\noindent $\_cubeWidth=5$

\noindent $\_cubeLength=5$

\noindent $\_cubeHeight=5$

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
setCubes & string & \{$\mathds{B}$,$\mathds{B}$,$\mathds{B}$\} & - \\
SendPuzzleDataServerRpc & $\mathds{I}$ & $\mathds{I}$ & - \\
UpdateTextServerRpc & string & string & - \\
SetIsometricPuzzlesServerRpc & string & string & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

puzzleData.connectedClients : Tuple\textlangle$\mathds{Z}$, Array\textlangle$\mathds{Z}$\textrangle\textrangle

\subsubsection{Environment Variables}

Device screen\\
This module has external interaction with an input field called solutionField, which has a property called "text" which allows characters to be pulled from it, as well as printed to the screen. There are also two buttons that call prevIsometric, and nextIsometric.

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent setCubes(key):
\begin{itemize}
\item output: $\forall x,y,z \in key => activeGrid[x,y,z]=true|activeGrid[x,y,z]=false$
\item exception: None
\end{itemize}

\noindent SendPuzzleDataServerRpc(p[]):
\begin{itemize}
\item output: puzzleData.connectedClients := p
\item exception: None
\end{itemize}

\noindent UpdateTextServerRpc(text):
\begin{itemize}
\item transition: If text=solution, transition to next puzzle
\item output: solutionField.text=text to all users in the lobby
\item exception: None
\end{itemize}

\noindent SetIsometricPuzzlesServerRpc(word):
\begin{itemize}
\item output: every player's $\_cubeNames$ is updated to have a random assortment of letter-number pairs from word, with each player having unique letter-number pairs. 
\item exception: None
\end{itemize}


\subsubsection{Local Functions}

nextIsometric(): Change the viewable letter-number pair to the next one in the list
\begin{itemize}
    \item output: cubeIndex=cubeIndex+1\\
    setCubes($\_cubeNames[cubeIndex])$
    \item exception: None
\end{itemize}

prevIsometric(): Change the viewable letter-number pair to the previous one in the list
\begin{itemize}
    \item output: cubeIndex=cubeIndex-1\\
    setCubes($\_cubeNames[cubeIndex])$
    \item exception: None
\end{itemize}

solutionFieldChanged(): Called when user hits enter on the inputfield on the screen, updates the inputfield on each user's screen
\begin{itemize}
    \item output: UpdateTextServerRpc(solutionField.text)
    \item exception: None
\end{itemize}

\subsubsection{Local Variables}

activeGrid : Array\textlangle $\mathds{B}$\textrangle

\_cubeNames : Array\textlangle string\textrangle

cubeIndex : $\mathds{I}$

\newpage

\section{MIS of {Wires Puzzle Module}} \label{sec:WiresModule} 

Puzzle module to be interacted with by two or more users. The module will generate a set of interactable wires for one user, and provide information on the correct order of wires to other users.
 
\subsection{Module}
WirePuzzle Module
\subsection{Uses}
Multiplayer Puzzle Module

\subsection{Syntax}

\subsubsection{Exported Constants}
NUM\_WIRES = 5

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{3cm} p{3cm} p{3cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GenerateWires & - & - & - \\
GenerateSequence & - & - & - \\
ConnectWire & $\mathds{Z}$, $\mathds{Z}$ & - & - \\
DisconnectWire & $\mathds{Z}$ & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

ConnectedWires : Array\textlangle$\mathds{B}$\textrangle \newline
Sequence : Array\textlangle$\mathds{Z}$\textrangle

\subsubsection{Environment Variables}

Device Screen\\
This module has external interaction with the phone screen, as there will be buttons in the game environment that the user presses which will be mapped to functions

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent {GenerateWires}():
\begin{itemize}
\item transition: Create the unity wire objects
\item exception: None
\end{itemize}

\noindent {GenerateSequence}():
\begin{itemize}
\item transition: $\forall$ i : 0 \textless i \textless NUM\_WIRES : wire[i].position = rand()
\item exception: None
\end{itemize}

\noindent {ConnectWire}(wireId, connectionId):
\begin{itemize}
\item transition: wire[wireId].connection = connectionId
\item exception: None
\end{itemize}

\noindent {DisconnectWire}(wireId):
\begin{itemize}
\item transition: wire[wireId].connection = -1
\item exception: None
\end{itemize}

\subsubsection{Local Functions}

None

\subsubsection{Local Variables}

None

\newpage

\section{MIS of Maze Puzzle Module} \label{sec:MazeModule} 

\subsection{Module}

The maze puzzle module is a module dedicated to the maze puzzle, where one user will be in control of rotating a maze to get a ball to roll from the start to the end, while the other users will guide the user in control to move the ball through the maze. 

\subsection{Uses}
Multiplayer Puzzle Module
\subsection{Syntax}

\subsubsection{Exported Constants}
\noindent $\_mazeWidth=10$

\noindent $\_mazeLength=10$
\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GenerateMaze & $\mathbb{N}$ & $\mathbb{Z}$ & - \\
RotateMaze & $\mathbb{R}$, $\mathbb{R}$, $\mathbb{R}$ & - & - \\
BallHitsGoal & - & - & - \\
SendPuzzleDataServerRpc & $\mathds{I}$ & $\mathds{I}$ & - \\
GenerateMazeServerRpc & Array\textlangle$\mathds{I}$\textrangle & Array\textlangle$\mathds{I}$\textrangle & -\\
resetRotationPress & - & - & -\\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

BallPosition : {$\mathbb{R}$,$\mathbb{R}$,$\mathbb{R}$}

\noindent MazeRotation : {$\mathbb{R}$,$\mathbb{R}$,$\mathbb{R}$}

\noindent mazeLayout : Array\textlangle$\mathds{I}$,$\mathds{I}$\textrangle

\noindent puzzleData.connectedClients : Tuple\textlangle$\mathds{Z}$, Array\textlangle$\mathds{Z}$\textrangle\textrangle



\subsubsection{Environment Variables}

The phone's gyroscope rotation triggers the RotateMaze function. 

\noindent A button is on the screen that calls resetRotationPress

\subsubsection{Assumptions}

\subsubsection{Access Routine Semantics}

\noindent {GenerateMaze}(NumberOfPlayer):
\begin{itemize}
\item transition: SpawnMaze(), BallPosition := (0,0,0)
\item output: ControllingPlayer := randInt(0,NumberOfPlayers-1)
\item exception: None
\end{itemize}

\noindent {RotateMaze}(Pitch, Yaw, Roll):
\begin{itemize}
\item transition: MazeRotation := {Pitch,Yaw,Roll}
\item exception: None
\end{itemize}

\noindent {BallHitsGoal}():
\begin{itemize}
\item transition: CompletePuzzle()
\item exception: None
\end{itemize}

\noindent SendPuzzleDataServerRpc(p[]):
\begin{itemize}
\item output: puzzleData.connectedClients := p
\item exception: None
\end{itemize}

\noindent GenerateMazeServerRpc(Array\textlangle$\mathds{I}$,$\mathds{I}$\textrangle  mazeLayouts):
\begin{itemize}
\item output: mazeLayouts of all connected clients becomes mazeLayouts
\item exception: None
\end{itemize}

\noindent resetRotationPress():
\begin{itemize}
\item output: MazeRotation = 0,0,0
\item exception: None
\end{itemize}


\subsubsection{Local Functions}

BallMovement: BallPosition x MazeRotation $\implies$ BallPosition $\equiv$ Based on current BallPosition and Maze Rotation, the current Position of the Ball changes to reflect the effect of gravity on the ball as it rolls downwards. 

\noindent To1DArray(input): Takes in a 2D int array and converts it to a 1D array
\begin{itemize}
    \item output: result := input to 1d array
    \item exception: None
\end{itemize}

\noindent convertLayoutToGrid(mazeLayouts): Takes in an array of integers between 0 and 3 and converts them to a maze grid.
\begin{itemize}
    \item transition:\_mazeGrid := Make2DArray(mazeLayouts)
    \item exception: None
\end{itemize}

\noindent Make2DArray(input,height,width): Takes in a 1D array and outputs a 2D array.
\begin{itemize}
    \item output: result := input to 2d array with height and width
    \item exception: None
\end{itemize}

\noindent GetNextUnvisitedCell(MazeCell currentcell): Helper function for generating the maze, gets an unvisited cell based off adjacent cells
\begin{itemize}
    \item output: cell := random(currentcell.adjacent)
    \item exception: None
\end{itemize}

\noindent ClearWalls(MazeCell previousCell, MazeCell currentCell): Removes two walls of the maze, based on relative location of the two cells.
\begin{itemize}
    \item transition: if(previousCell.x<currentCell.x) then previousCell.ClearRightWall() currentCell.ClearLeftWall()\\
    if (previousCell.transform.position.x >currentCell.transform.position.x) then previousCell.ClearLeftWall() currentCell.ClearRightWall()\\
    if (previousCell.transform.position.z < currentCell.transform.position.z)then  previousCell.ClearFrontWall() currentCell.ClearRearWall()\\
    if (previousCell.transform.position.z > currentCell.transform.position.z) then previousCell.ClearRearWall() currentCell.ClearFrontWall()
    \item exception: None
\end{itemize}


\subsubsection{Local Variables}

Goal Location : {$\mathbb{R}$,$\mathbb{R}$,$\mathbb{R}$}

\noindent ControllingPlayerIndex : $0<\mathbb{N}<10$

\newpage

\section{MIS of Bomb Puzzle Module} \label{sec:Combination} 

\noindent The Bomb Puzzle Module implements functionality for the combination discovery puzzle that is present in the application. This puzzle involves two to 4 users. An instruction card is generated for each user that only they can see, giving a subset of the instructions to solve a number combination. All users must communicate to combine their instructions to solve the combination.

\subsection{Module}
BombPuzzle

\subsection{Uses}
Multiplayer Puzzle Module

\subsection{Syntax}

\subsubsection{Exported Constants}
COMBO\_LENGTH=4

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GenerateCombo & - & Array of strings & - \\
ConvertButtonPress & - & char & - \\
CheckEntry & char, Array of strings & $\mathds{B}$ & - \\
ColourBlink & - & - & - \\
Restart & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

comboSet : Array of strings

\subsubsection{Environment Variables}

Device Screen\\
This module has external interaction with the phone screen, as there will be buttons in the game environment that the user presses which will be mapped to functions


\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent GenerateCombo():
\begin{itemize}
\item transition: comboSet := randCombo(comboArray)
\item output: out := $ (\forall i : 0<=i<=numPlayers : player[i].instructions = comboSet[i+1]$, if $numPlayers<4$, loop back through remaining players assigning remaining instructions
\item exception: None
\end{itemize}

\noindent ConvertButtonPress():
\begin{itemize}
\item transition: None
\item output: userInput:= When button on keypad pressed, output character of equivalent number from 0-9
\item exception: None
\end{itemize}

\noindent CheckEntry(userInput, comboSet):
\begin{itemize}
\item transition: $userInput == comboSet[0][currentDigit] \land currentDigit<4 => currentDigit+=1$
\item output: success := $userInput == comboSet[0][currentDigit] \land currentDigit==4 => success=True | else success = False$
\item exception: None
\end{itemize}

\noindent ColourBlink():
\begin{itemize}
\item transition: $success == True =>$ screen flash green $\: | \: else =>$ screen flash red, Restart()
\item output: None
\item exception: None
\end{itemize}

\noindent Restart():
\begin{itemize}
\item transition: currentDigit = 0, GenerateCombo()
\item output: None
\item exception: None
\end{itemize}


\subsubsection{Local Functions}
randCombo(comboArray): Select random combination-instruction set from comboArray
\begin{itemize}
    \item output: combo := newCombo
    \item exception: None
\end{itemize}

\subsubsection{Local Variables}
currentDigit := 0 $\{0<=\mathbb{N}<4\}$\\
success : $\mathds{B}$\\
comboArray := Array of arrays of strings of length 5. The first element of these subarrays is the combination of length COMBO\_LENGTH. The next 4 elements are the 4 instructions associated with this combo.\\
\newpage

\section{MIS of Database/Network Manager Module} \label{sec:DatabaseNetworkModule} 

\subsection{Module}

DatabaseNetwork Module

\subsection{Uses}

None

\subsection{Syntax}

\subsubsection{Exported Constants}

None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
OnNetworkSpawn & - & - & - \\
OnNetworkDespawn  & - & - & - \\
HandleClientConnected  & $\mathbb{R}$ & - & - \\
HandleClientDisconnected  & $\mathbb{R}$ & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

players : NetworkList$<PlayerData>$

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent {OnNetworkSpawn}():
\begin{itemize}
\item transition: On initial connection to the network, update $players$ with the host information and all the clients who have joined the network.
\item exception: None
\end{itemize}\

\noindent {OnNetworkDespawn}():
\begin{itemize}
\item transition: When the network is closed disconnect all users from the network and remove all users from $players$.
\item exception: None
\end{itemize}

\noindent {HandleClientConnected}(clientId):
\begin{itemize}
\item transition: players.Add(new PlayerData(clientId))
\item exception: None
\end{itemize}

\noindent {HandleClientDisconnected}(clientId):
\begin{itemize}
\item transition: if $  \exists i: 0 <= i < length(players) : \newline players[i].clientId == clientId => players.RemoveAt(i) $
\item exception: None
\end{itemize}

\subsubsection{Local Functions}

None

\newpage


\section{MIS of {Error Manager Module}} \label{sec:ErrorModule} 

\subsection{Module}

This module catches and manages all the error that pop up to give the user a more descriptive and readable version of the error that they encountered.

\subsection{Uses}

None

\subsection{Syntax}

\subsubsection{Exported Constants}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{3.2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
Get & - & LogHandler & - \\
LogFormat & $\mathds{N}$, UnityObject, string, object & LogHandler & - \\
LogException & Exception, object & - &-\\
SpawnErrorPopup & string & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

ShowErrorMessage : $\mathds{B}$

\subsubsection{Environment Variables}

There are buttons that the user has access to, that will activate some of these functions directly when pressed

\subsubsection{Assumptions}

\subsubsection{Access Routine Semantics}

\noindent {Get}():
\begin{itemize}
\item output: out:= LogHandlerInstance
\item exception: None
\end{itemize}

\noindent {LogFormat}(logtype,context,format,args[]):
\begin{itemize}
\item output: out := m\_DefaultLogHandler.LogFormat(logtype, context, format, args)
\item exception: None
\end{itemize}

\noindent {LogException}(exception, context):
\begin{itemize}
\item output: out:= m\_DefaultLogHandler.LogException(exception, context)
\item exception: None
\end{itemize}

\noindent {SpawnErrorPopup}(errorMessage):
\begin{itemize}
\item transition: ShowErrorMessage := true , gameOject.SetActive(true)
\item exception: None
\end{itemize}

\noindent {ClearPopup}():
\begin{itemize}
\item transition: gameOject.SetActive(false)
\item exception: None
\end{itemize}


\subsubsection{Local Functions}
None

\newpage 

\section{MIS of {Documentation Module}} \label{sec:DocModule} 
Module used to map requirements that are related to user documentation. 
\subsection{Module}

\subsection{Uses}
 None

\subsection{Syntax}

\subsubsection{Exported Constants}
N/A
\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
- & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

None

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

None

\subsubsection{Local Functions}

None

\newpage


\bibliographystyle {plainnat}
\bibliography {References}

\newpage

\section{Appendix} \label{Appendix}


The information in this section will be used to evaluate the team members on the
graduate attribute of Problem Analysis and Design.  Please answer the following questions:

\begin{enumerate}
  \item What are the limitations of your solution?  Put another way, given
  unlimited resources, what could you do to make the project better? (LO\_ProbSolutions)

One of the main limitations of the project is the time constraint, as well as balancing the project with other courses members of the team are taking. As a result, certain features such as UI elements may be less aesthetic/nice looking due to having less time to work on them. Given unlimited resources, the following updates to the project could be made.

\begin{itemize}
    \item Improved UI elements
    \item Creation of additional puzzle modules/types
    \item Modification of current puzzle modules to allow them to work with several different amounts of people (ex. 2-player, 3-player, 4-player, etc.)
\end{itemize}

Another limitation of the project is the lack of choice regarding frameworks that can be used to implement AR elements. This project requires an AR game environment and there are only a few frameworks that can be used to implement AR elements, such as Unity. As a result, our team chose to use Unity to implement the application.
  
  \item Give a brief overview of other design solutions you considered.  What
  are the benefits and tradeoffs of those other designs compared with the chosen
  design?  From all the potential options, why did you select the documented design?
  (LO\_Explores)

As mentioned previously, there are not many frameworks that allow for the implementation of AR elements. At the beginning of the project, our team debated about whether to use Unreal Engine or Unity, however, we decided on Unity due to the fact that several group members had much more experience with Unity. Additionally, there are many benefits of using unity. First of all, there are many AR libraries that work hand in hand with Unity which is extremely useful for our project. Additionally, Unity has an asset store where we can get assets to be used in our game environment which is also extremely useful. Additionally, even though Unity does have many benefits, there are some negatives such as it being extremely difficult to do automated testing with Unity. Moving on, another design decision that we chose was using Vivox framework for the implementation of voice and text communication. The benefits of this is that Unity supports the use of Vivox and so the implementation of voice and text communication was not too difficult. The tradeoff, however, is that there is less freedom for the actual implementation of these communication features, as Vivox has to be set up in a specific way and only has certain functionality.
\end{enumerate}


\end{document}

\end{document}